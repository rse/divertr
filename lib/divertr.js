/*
**  Divertr -- Text Diversion Filter
**  Copyright (c) 1997-2016 Ralf S. Engelschall <rse@engelschall.com>
**
**  Permission is hereby granted, free of charge, to any person obtaining
**  a copy of this software and associated documentation files (the
**  "Software"), to deal in the Software without restriction, including
**  without limitation the rights to use, copy, modify, merge, publish,
**  distribute, sublicense, and/or sell copies of the Software, and to
**  permit persons to whom the Software is furnished to do so, subject to
**  the following conditions:
**
**  The above copyright notice and this permission notice shall be included
**  in all copies or substantial portions of the Software.
**
**  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
**  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
**  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
**  IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
**  CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
**  TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
**  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Divertr = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_tokenizr=_dereq_("tokenizr"),_tokenizr2=_interopRequireDefault(_tokenizr),divertr=function(e,n){n=Object.assign({},{syntax:"std",debug:!1},n);var r={std:{regexDump:/-\{([a-zA-Z][a-zA-Z0-9_]*)\}-/,regexEnter:/-\{(\!?)([a-zA-Z][a-zA-Z0-9_]*)(\!?):/,regexLeave:/:((?:[a-zA-Z][a-zA-Z0-9_]*)?)\}-/},alt:{regexDump:/-\{([a-zA-Z][a-zA-Z0-9_]*)\}-/,regexEnter:/-(\!?)([a-zA-Z][a-zA-Z0-9_]*)(\!?)->/,regexLeave:/<-((?:[a-zA-Z][a-zA-Z0-9_]*)?)-/},xml:{regexDump:/<([a-zA-Z][a-zA-Z0-9_]*)\/>/,regexEnter:/<(\!?)([a-zA-Z][a-zA-Z0-9_]*)(\!?)>/,regexLeave:/<\/((?:[a-zA-Z][a-zA-Z0-9_]*)?)>/},mustache:{regexDump:/\{\{([a-zA-Z][a-zA-Z0-9_]*)\}\}/,regexEnter:/\{\{#(\!?)([a-zA-Z][a-zA-Z0-9_]*)(\!?)\}\}/,regexLeave:/\{\{\/((?:[a-zA-Z][a-zA-Z0-9_]*)?)\}\}/},rpm:{regexDump:/%\{([a-zA-Z][a-zA-Z0-9_]*)\}/,regexEnter:/%\{(\!?)([a-zA-Z][a-zA-Z0-9_]*)(\!?):/,regexLeave:/:((?:[a-zA-Z][a-zA-Z0-9_]*)?)\}/},"wml-macro":{regexDump:/\{#([a-zA-Z][a-zA-Z0-9_]*)#\}/,regexEnter:/\{#(\!?)([a-zA-Z][a-zA-Z0-9_]*)(\!?)#:/,regexLeave:/:#((?:[a-zA-Z][a-zA-Z0-9_]*)?)#\}/},"wml-diversion":{regexDump:/<<([a-zA-Z][a-zA-Z0-9_]*)>>/,regexEnter:/\.\.(\!?)([a-zA-Z][a-zA-Z0-9_]*)(\!?)>>/,regexLeave:/<<((?:[a-zA-Z][a-zA-Z0-9_]*)?)\.\./}};if("string"==typeof n.syntax){if(void 0===r[n.syntax])throw new Error("unknown pre-defined syntax");n.syntax=r[n.syntax]}if("object"!==_typeof(n.syntax))throw new Error("invalid syntax option");if("string"==typeof n.syntax.regexDump&&(n.syntax.regexDump=new RegExp(n.syntax.regexDump)),!("object"===_typeof(n.syntax.regexDump)&&n.syntax.regexDump instanceof RegExp))throw new Error("invalid syntax.regexDump option (RegExp or String expected)");if("string"==typeof n.syntax.regexEnter&&(n.syntax.regexEnter=new RegExp(n.syntax.regexEnter)),!("object"===_typeof(n.syntax.regexEnter)&&n.syntax.regexEnter instanceof RegExp))throw new Error("invalid syntax.regexEnter option (RegExp or String expected)");if("string"==typeof n.syntax.regexLeave&&(n.syntax.regexLeave=new RegExp(n.syntax.regexLeave)),!("object"===_typeof(n.syntax.regexLeave)&&n.syntax.regexLeave instanceof RegExp))throw new Error("invalid syntax.regexLeave option (RegExp or String expected)");var t={location:"main",stack:["null"],buffer:{null:[],main:[]},overwrite:{}},a=new _tokenizr2.default;a.rule(n.syntax.regexDump,function(e,n){e.accept("DUMP",{name:n[1]})}),a.rule(n.syntax.regexEnter,function(e,n){e.accept("ENTER",{name:n[2],rewindNow:""!==n[1],rewindNext:""!==n[3]})}),a.rule(n.syntax.regexLeave,function(e,n){e.accept("LEAVE",{name:n[1]})});var o="";a.before(function(e,n,r){"plaintext"!==r.name&&""!==o&&(e.accept("PLAINTEXT",o),o="")}),a.rule(/(?:.|\r?\n)/,function(e,n){o+=n[0],e.ignore()},"plaintext"),a.finish(function(e){""!==o&&e.accept("PLAINTEXT",o)}),a.input(e),a.debug(n.debug),a.tokens().forEach(function(e){if(e.isA("DUMP")){var n=e.value.name;if(void 0===t.buffer[n]&&(t.buffer[n]=[]),t.buffer[t.location]===t.buffer[n])throw new Error('self-reference of location "'+t.location+'"');t.buffer[t.location].push(t.buffer[n])}else if(e.isA("ENTER")){t.stack.push(t.location),t.location=e.value.name;var r=e.value.rewindNow,a=e.value.rewindNext;if(void 0===t.buffer[t.location]&&(t.buffer[t.location]=[]),t.overwrite[t.location]&&(r=!0,t.overwrite[t.location]=!1),a&&(t.overwrite[t.location]=!0),r)for(;t.buffer[t.location].length>0;)t.buffer[t.location].pop()}else if(e.isA("LEAVE")){if(0===t.stack.length)throw new Error('cannot leave "null" location (already in "null" location)');var o=e.value.name;if("null"===o)throw new Error('cannot leave "null" location (not allowed at all)');if(""!==o&&o!==t.location){var i=t.stack.indexOf(o);if(i===-1)throw new Error('no such entered location "'+o+'"');t.stack.splice(i),t.location=t.stack.pop()}else t.location=t.stack.pop()}else e.isA("PLAINTEXT")&&t.buffer[t.location].push(e.value)}),n.debug&&console.log("INTERNAL STATE AFTER PASS 1:\n"+JSON.stringify(t,null,"    "));var i=function e(n){t.stack.forEach(function(e){if(e===n){var r="unknown";throw Object.keys(t.buffer).forEach(function(e){t.buffer[e]===n&&(r=e)}),new Error('recursion through location "'+r+'"')}}),t.stack.push(n);var r="";return n.forEach(function(n){r+="object"===("undefined"==typeof n?"undefined":_typeof(n))?e(n):n}),t.stack.pop(),r};t.stack=[];var f=i(t.buffer.main);return f};module.exports=divertr;
},{"tokenizr":"tokenizr"}]},{},[1])(1)
});


//# sourceMappingURL=divertr.map